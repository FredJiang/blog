---
title: 生成邀请码
date: 2015-02-12 16:38:13
tags: [algorithm, invite]
---

### 需求

* 生成长度为 4 位的字符串邀请码
* 可以有数字和英文字母
* 英文字符不区分大小写
* 邀请码没有过期

<!--more-->

### 实现过程
###### 将数字转换成邀请码

|   输入  | 输出 |
|---------|------|
|       0 | 0000 |
|   49360 | 1234 |
| 1679615 | zzzz |

实现方法，将 10 进制转为 36 进制

```
function getInvitingCode(codeNumber) {
    var items = [
        "0", "1", "2", "3", "4", "5", "6", "7", "8", "9",
        "a", "b", "c", "d",
        "e", "f", "g",
        "h", "i", "j", "k",
        "l", "m", "n",
        "o", "p", "q",
        "r", "s", "t",
        "u", "v", "w",
        "x", "y", "z"
    ]
    var finalArray = []
    var maxLength = 4

    for (var i = 0; i < maxLength; i++) {
        finalArray[i] = items[Math.floor(codeNumber / Math.pow(items.length, maxLength - i - 1))]
        codeNumber = codeNumber % Math.pow(items.length, maxLength - i - 1)
        console.log(finalArray)
    }

    return finalArray.join().replace(/,/ig, "")
}
console.log(getInvitingCode(0000) == "0000")
console.log(getInvitingCode(49360) == "1234")
console.log(getInvitingCode(1679615) == "zzzz")
```

打印结果

```
[ '0' ]
[ '0', '0' ]
[ '0', '0', '0' ]
[ '0', '0', '0', '0' ]
true
[ '1' ]
[ '1', '2' ]
[ '1', '2', '3' ]
[ '1', '2', '3', '4' ]
true
[ 'z' ]
[ 'z', 'z' ]
[ 'z', 'z', 'z' ]
[ 'z', 'z', 'z', 'z' ]
true
```

###### 使用方法

1. 根据数据库中已有的邀请码个数，生成下一个邀请码

	比如数据库中已经有 1000 个了，则下一个邀请码由 getInvitingCode(1001) 得到 07pt
	
	问题
	
	* 这样没有达到随机的效果，比如我得到了 0001 这样一个邀请码，则下一个就是 0002
	
2. 随机生成一个数字，然后根据这个数字得到邀请码，如果数据库中没有这个邀请码，则保存，如果有的话，换一个数字，循环操作，直到生成新的邀请码
	
	问题
	
	* 太慢，随着生成的邀请码增多，越来越慢
	* 我随便猜一个邀请码 0001，按道理来说，肯定是有这样一个邀请码的，也没实现真正的随机

上面两种，我用了第一种，发现在客户端看到的邀请码太有规律了，所以不能用

要想实现随机，那就得减少邀请码的总数 36^{4} = 1679616

1. 最后一位为 0 至 9 的随机数
	
	去掉最后一位，邀请码总个数为 1679616 / 10 = 167961
	
	比如数据库中已有 1000 个邀请码，那么下一个就是 1001 + 一位随机数，即 10010(07q2) 到 10019(07qb)
	
	问题	
	
	* 1001 猜 10 次，也能猜到
	* 有很多 0xxx 的数据（个人觉得不好）

2. 最后两位为 0 至 99 的随机数
	
	逻辑同上，邀请码总个数为 1679616 / 100 = 16796，要猜 100 次

3. 前面两位取 0 至 15 的随机数
 
	1679616 去掉前两位，还剩 79616 位
	
	比如数据库中有 1000 个邀请码，下一个则为 (0至15) * 100000 + 1001

4. 前面两位取 0 至 15 的随机数，并提前存到数据库
	
	* 邀请码，根据字符来排序，由于前面取的是随机数，那排序后，就得到了随机的顺序了
	* 每次从数据库总去一个还没用的邀请码
	
###### update

为了减小被猜出来的可能性，可将 items 顺序打乱

如

```
    var items = [
        "0", "1", "2", "3", "4", "5", "6", "7", "8", "9",
        "a", "b", "c", "d",
        "e", "f", "g",
        "h", "i", "g", "k",
        "l", "m", "n",
        "o", "p", "q",
        "r", "s", "t",
        "u", "v", "w",
        "x", "y", "z"
    ]
```

可变为 

```
    var items = [
        "a", "b", "c", "d",
        "0", "1", "2", "3", "4", "5", "6", "7", "8", "9",
        "h", "i", "g", "k",
        "e", "f", "g",
        "l", "m", "n",
        "o", "p", "q",
        "u", "v", "w",
        "r", "s", "t",
        "x", "y", "z"
    ]
```


