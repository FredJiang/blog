<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1115px" preserveAspectRatio="none" style="width:850px;height:1115px;" version="1.1" viewBox="0 0 850 1115" width="850px" zoomAndPan="magnify"><defs><filter height="300%" id="f120qvkqgeibqi" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><ellipse cx="201" cy="20" fill="#000000" filter="url(#f120qvkqgeibqi)" rx="10" ry="10" style="stroke: none; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f120qvkqgeibqi)" height="34.1328" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="48" x="177" y="50"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="28" x="187" y="71.6016">main</text><path d="M258,90.375 L258,183.2383 L238,187.2383 L258,191.2383 L258,284.1016 A0,0 0 0 0 258,284.1016 L838,284.1016 A0,0 0 0 0 838,284.1016 L838,100.375 L828,90.375 L258,90.375 A0,0 0 0 0 258,90.375 " fill="#FBFB77" filter="url(#f120qvkqgeibqi)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M828,90.375 L828,100.375 L838,100.375 L828,90.375 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="264" y="107.9434">v8::V8::InitializeICUDefaultLocation(argv[0]);</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="281" x="264" y="123.2539">v8::V8::InitializeExternalStartupData(argv[0]);</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="491" x="264" y="138.5645">std::unique_ptr&lt;v8::Platform&gt; platform = v8::platform::NewDefaultPlatform();</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="252" x="264" y="153.875">v8::V8::InitializePlatform(platform.get());</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="264" y="169.1855">v8::V8::Initialize();</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="337" x="264" y="184.4961">v8::V8::SetFlagsFromCommandLine(&amp;argc, argv, true);</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="257" x="264" y="199.8066">v8::Isolate::CreateParams create_params;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="559" x="264" y="215.1172">create_params.array_buffer_allocator = v8::ArrayBuffer::Allocator::NewDefaultAllocator();</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="338" x="264" y="230.4277">v8::Isolate* isolate = v8::Isolate::New(create_params);</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="264" y="245.7383">.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="264" y="261.0488">.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="264" y="276.3594">.</text><rect fill="#FEFECE" filter="url(#f120qvkqgeibqi)" height="34.1328" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="74" x="164" y="170.1719"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="54" x="174" y="191.7734">初始化 v8</text><path d="M285,284.1016 L285,361.6543 L265,365.6543 L285,369.6543 L285,447.207 A0,0 0 0 0 285,447.207 L776,447.207 A0,0 0 0 0 776,447.207 L776,294.1016 L766,284.1016 L285,284.1016 A0,0 0 0 0 285,284.1016 " fill="#FBFB77" filter="url(#f120qvkqgeibqi)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M766,284.1016 L766,294.1016 L776,294.1016 L766,284.1016 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="264" x="291" y="301.6699">// Create a template for the global object.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="470" x="291" y="316.9805">v8::Local&lt;v8::ObjectTemplate&gt; global = v8::ObjectTemplate::New(isolate);</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="376" x="291" y="332.291">// Bind the global 'print' function to the C++ Print callback.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="291" y="347.6016">global-&gt;Set(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="439" x="307" y="362.9121">v8::String::NewFromUtf8(isolate, "print", v8::NewStringType::kNormal)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="323" y="378.2227">.ToLocalChecked(),</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="307" y="393.5332">v8::FunctionTemplate::New(isolate, Print));</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="291" y="408.8438">.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="291" y="424.1543">.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="291" y="439.4648">.</text><rect fill="#FEFECE" filter="url(#f120qvkqgeibqi)" height="34.1328" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="128" x="137" y="348.5879"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="108" x="147" y="370.1895">CreateShellContext</text><rect fill="#FEFECE" filter="url(#f120qvkqgeibqi)" height="34.1328" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="296" x="53" y="460.9648"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="276" x="63" y="482.5664">给 js 添加全局方法, 并和 c++ 的对应方法代码绑定</text><rect fill="#000000" filter="url(#f120qvkqgeibqi)" height="6" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 1.0;" width="382" x="10" y="515.0977"/><rect fill="#FEFECE" filter="url(#f120qvkqgeibqi)" height="34.1328" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="47" x="24" y="541.0977"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="27" x="34" y="562.6992">print</text><rect fill="#FEFECE" filter="url(#f120qvkqgeibqi)" height="34.1328" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="47" x="99" y="541.0977"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="27" x="109" y="562.6992">read</text><rect fill="#FEFECE" filter="url(#f120qvkqgeibqi)" height="34.1328" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="45" x="174" y="541.0977"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="25" x="184" y="562.6992">load</text><rect fill="#FEFECE" filter="url(#f120qvkqgeibqi)" height="34.1328" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="42" x="247" y="541.0977"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="22" x="257" y="562.6992">quit</text><rect fill="#FEFECE" filter="url(#f120qvkqgeibqi)" height="34.1328" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="61" x="317" y="541.0977"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="41" x="327" y="562.6992">version</text><rect fill="#000000" filter="url(#f120qvkqgeibqi)" height="6" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 1.0;" width="382" x="10" y="595.2305"/><rect fill="#FEFECE" filter="url(#f120qvkqgeibqi)" height="34.1328" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="68" x="167" y="621.2305"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="48" x="177" y="642.832">RunShell</text><rect fill="#FEFECE" filter="url(#f120qvkqgeibqi)" height="34.1328" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="110" x="146" y="719.3633"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="90" x="156" y="740.9648">等待输入 js 代码</text><polygon fill="#FEFECE" filter="url(#f120qvkqgeibqi)" points="78,773.4961,182,773.4961,194,785.4961,182,797.4961,78,797.4961,66,785.4961,78,773.4961" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="18" x="134" y="808.1309">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="104" x="78" y="789.6533">print("hello world!")</text><polygon fill="#FEFECE" filter="url(#f120qvkqgeibqi)" points="226,773.4961,274,773.4961,286,785.4961,274,797.4961,226,797.4961,214,785.4961,226,773.4961" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="18" x="254" y="808.1309">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="48" x="226" y="789.6533">version()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="44" x="286" y="783.1758">其他输入</text><rect fill="#FEFECE" filter="url(#f120qvkqgeibqi)" height="34.1328" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="129" x="136.5" y="850.2861"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="109" x="146.5" y="871.8877">v8::Script::Compile</text><rect fill="#FEFECE" filter="url(#f120qvkqgeibqi)" height="34.1328" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="91" x="155.5" y="904.4189"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="71" x="165.5" y="926.0205">script-&gt;Run</text><rect fill="#FEFECE" filter="url(#f120qvkqgeibqi)" height="34.1328" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="155" y="958.5518"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="72" x="165" y="980.1533">打印执行结果</text><polygon fill="#FEFECE" filter="url(#f120qvkqgeibqi)" points="201,675.3633,213,687.3633,201,699.3633,189,687.3633,201,675.3633" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#FEFECE" filter="url(#f120qvkqgeibqi)" points="188,1040.46,214,1040.46,226,1052.46,214,1064.46,188,1064.46,176,1052.46,188,1040.46" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="26" x="188" y="1056.6172">quit?</text><ellipse cx="201" cy="1094.46" fill="none" filter="url(#f120qvkqgeibqi)" rx="10" ry="10" style="stroke: #000000; stroke-width: 1.0;"/><ellipse cx="201.5" cy="1094.96" fill="#000000" filter="url(#f120qvkqgeibqi)" rx="6" ry="6" style="stroke: none; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="201" x2="201" y1="30" y2="50"/><polygon fill="#A80036" points="197,40,201,50,205,40,201,44" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="201" x2="201" y1="84.1328" y2="170.1719"/><polygon fill="#A80036" points="197,160.1719,201,170.1719,205,160.1719,201,164.1719" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="201" x2="201" y1="204.3047" y2="348.5879"/><polygon fill="#A80036" points="197,338.5879,201,348.5879,205,338.5879,201,342.5879" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="201" x2="201" y1="382.7207" y2="460.9648"/><polygon fill="#A80036" points="197,450.9648,201,460.9648,205,450.9648,201,454.9648" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="47.5" x2="47.5" y1="521.0977" y2="541.0977"/><polygon fill="#A80036" points="43.5,531.0977,47.5,541.0977,51.5,531.0977,47.5,535.0977" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="122.5" x2="122.5" y1="521.0977" y2="541.0977"/><polygon fill="#A80036" points="118.5,531.0977,122.5,541.0977,126.5,531.0977,122.5,535.0977" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="196.5" x2="196.5" y1="521.0977" y2="541.0977"/><polygon fill="#A80036" points="192.5,531.0977,196.5,541.0977,200.5,531.0977,196.5,535.0977" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="268" x2="268" y1="521.0977" y2="541.0977"/><polygon fill="#A80036" points="264,531.0977,268,541.0977,272,531.0977,268,535.0977" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="347.5" x2="347.5" y1="521.0977" y2="541.0977"/><polygon fill="#A80036" points="343.5,531.0977,347.5,541.0977,351.5,531.0977,347.5,535.0977" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="47.5" x2="47.5" y1="575.2305" y2="595.2305"/><polygon fill="#A80036" points="43.5,585.2305,47.5,595.2305,51.5,585.2305,47.5,589.2305" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="122.5" x2="122.5" y1="575.2305" y2="595.2305"/><polygon fill="#A80036" points="118.5,585.2305,122.5,595.2305,126.5,585.2305,122.5,589.2305" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="196.5" x2="196.5" y1="575.2305" y2="595.2305"/><polygon fill="#A80036" points="192.5,585.2305,196.5,595.2305,200.5,585.2305,196.5,589.2305" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="268" x2="268" y1="575.2305" y2="595.2305"/><polygon fill="#A80036" points="264,585.2305,268,595.2305,272,585.2305,268,589.2305" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="347.5" x2="347.5" y1="575.2305" y2="595.2305"/><polygon fill="#A80036" points="343.5,585.2305,347.5,595.2305,351.5,585.2305,347.5,589.2305" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="201" x2="201" y1="495.0977" y2="515.0977"/><polygon fill="#A80036" points="197,505.0977,201,515.0977,205,505.0977,201,509.0977" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="201" x2="201" y1="601.2305" y2="621.2305"/><polygon fill="#A80036" points="197,611.2305,201,621.2305,205,611.2305,201,615.2305" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="130" x2="130" y1="797.4961" y2="829.6309"/><polygon fill="#A80036" points="126,819.6309,130,829.6309,134,819.6309,130,823.6309" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="250" x2="250" y1="797.4961" y2="829.6309"/><polygon fill="#A80036" points="246,819.6309,250,829.6309,254,819.6309,250,823.6309" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="194" x2="214" y1="785.4961" y2="785.4961"/><polygon fill="#A80036" points="204,781.4961,214,785.4961,204,789.4961,208,785.4961" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="201" x2="201" y1="753.4961" y2="758.4961"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="201" x2="130" y1="758.4961" y2="758.4961"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="130" x2="130" y1="758.4961" y2="773.4961"/><polygon fill="#A80036" points="126,763.4961,130,773.4961,134,763.4961,130,767.4961" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="286" x2="321" y1="785.4961" y2="785.4961"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="321" x2="321" y1="785.4961" y2="829.6309"/><polygon fill="#A80036" points="317,819.6309,321,829.6309,325,819.6309,321,823.6309" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="130" x2="321" y1="829.6309" y2="829.6309"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="201" x2="201" y1="829.6309" y2="850.2861"/><polygon fill="#A80036" points="197,840.2861,201,850.2861,205,840.2861,201,844.2861" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="201" x2="201" y1="884.4189" y2="904.4189"/><polygon fill="#A80036" points="197,894.4189,201,904.4189,205,894.4189,201,898.4189" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="201" x2="201" y1="938.5518" y2="958.5518"/><polygon fill="#A80036" points="197,948.5518,201,958.5518,205,948.5518,201,952.5518" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="201" x2="201" y1="699.3633" y2="719.3633"/><polygon fill="#A80036" points="197,709.3633,201,719.3633,205,709.3633,201,713.3633" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="226" x2="348" y1="1052.46" y2="1052.46"/><polygon fill="#A80036" points="344,830.2861,348,820.2861,352,830.2861,348,826.2861" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="348" x2="348" y1="687.3633" y2="1052.46"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="348" x2="213" y1="687.3633" y2="687.3633"/><polygon fill="#A80036" points="223,683.3633,213,687.3633,223,691.3633,219,687.3633" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="201" x2="201" y1="992.6846" y2="1040.46"/><polygon fill="#A80036" points="197,1030.46,201,1040.46,205,1030.46,201,1034.46" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="51" x="205" y="1014.1396">printf("%s</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="35" x="205" y="1027.0947">", cstr)</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="201" x2="201" y1="655.3633" y2="675.3633"/><polygon fill="#A80036" points="197,665.3633,201,675.3633,205,665.3633,201,669.3633" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="201" x2="201" y1="1064.46" y2="1084.46"/><polygon fill="#A80036" points="197,1074.46,201,1084.46,205,1074.46,201,1078.46" style="stroke: #A80036; stroke-width: 1.0;"/><!--
@startuml shell

start

:main;

:初始化 v8;
note right
  v8::V8::InitializeICUDefaultLocation(argv[0]);
  v8::V8::InitializeExternalStartupData(argv[0]);
  std::unique_ptr<v8::Platform> platform = v8::platform::NewDefaultPlatform();
  v8::V8::InitializePlatform(platform.get());
  v8::V8::Initialize();
  v8::V8::SetFlagsFromCommandLine(&argc, argv, true);
  v8::Isolate::CreateParams create_params;
  create_params.array_buffer_allocator = v8::ArrayBuffer::Allocator::NewDefaultAllocator();
  v8::Isolate* isolate = v8::Isolate::New(create_params);
  .
  .
  .
end note

:CreateShellContext;
note right
  // Create a template for the global object.
  v8::Local<v8::ObjectTemplate> global = v8::ObjectTemplate::New(isolate);
  // Bind the global 'print' function to the C++ Print callback.
  global->Set(
      v8::String::NewFromUtf8(isolate, "print", v8::NewStringType::kNormal)
          .ToLocalChecked(),
      v8::FunctionTemplate::New(isolate, Print));
  .
  .
  .
end note

:给 js 添加全局方法, 并和 c++ 的对应方法代码绑定;

fork
  :print;
fork again
  :read;
fork again
  :load;
fork again
  :quit;
fork again
  :version;
end fork

:RunShell;

repeat
  :等待输入 js 代码;
  if (print("hello world!")) then (yes)
  elseif (version()) then (yes)
  else (其他输入)
  endif

  :v8::Script::Compile;

  :script->Run;

  :打印执行结果;
  -> printf("%s\n", cstr);

repeat while (quit?)

stop

@enduml

PlantUML version 1.2018.03(Fri Apr 06 00:59:15 CST 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_112-b16
Operating System: Mac OS X
OS Version: 10.13.4
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>